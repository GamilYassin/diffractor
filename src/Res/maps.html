<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<title>map</title>
	<style type="text/css">
		#map {
			height: 100%;
		}

		html, body {
			height: 100%;
			margin: 0;
			padding: 0;
		}
	</style>
</head>
<body>
<div id="map"></div>
<script>
	var map;
	var search_manager;
	var start_loc;
	var maxz = 16;
	var markers = [];
	var is_initialised = false;

	function map_js_loaded() {

		start_loc = new Microsoft.Maps.Location(51.477928, -0.001545);

		map = new Microsoft.Maps.Map(document.getElementById('map'),
			{
				zoom: 8,
                minZoom: 3,
                maxZoom: maxz,
				center: start_loc,
			});

        Microsoft.Maps.Events.addHandler(map,
            'click',
            function (event) {
               var loc = event.location;
                delete_markers();
                add_location_marker(loc);
				window.external.select_place(result.location.latitude, result.location.longitude);
            });

        is_initialised = true;
	}

	function set_location_marker(latitude, longitude) {
		if (is_initialised) {
			delete_markers();
			var loc = new Microsoft.Maps.Location(latitude, longitude);
			add_location_marker(loc);
			map.setView({ center: loc });
		} else {
			start_loc = { lat: loc.latitude, lng: loc.longitude };
		}
	}

	function add_location_marker(location) {
		if (is_initialised) {
			var marker = new Microsoft.Maps.Pushpin(location, { });
			map.entities.push(marker);
			markers.push(marker);
		}
	}

	function delete_markers() {
		if (markers) {
			for (var i = 0; i < markers.length; i++) 
			{
              map.entities.remove(markers[i]);
            }
			markers.length = 0;
		}
	}

	function init_map(key) {
		var js_url = "https://www.bing.com/api/maps/mapcontrol?callback=map_js_loaded&key=" + key;
        var tag = document.createElement("script");
		tag.setAttribute('src', js_url);
		tag.setAttribute('defer','');
		var first_script_tag = document.getElementsByTagName('script')[0];
		first_script_tag.parentNode.insertBefore(tag, first_script_tag);
	}
</script>

</body>
</html>