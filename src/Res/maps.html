<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="x-ua-compatible" content="IE=edge" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />	
	<title>map</title>
	<style type="text/css">
		#map {
			height: 100%;
		}

		html, body {
			height: 100%;
			margin: 0;
			padding: 0;
		}
	</style>
</head>
<body>
<div id="map"></div>
<script>
	var map;
	var places_service;
	var start_loc = { lat: 51.477928, lng: -0.001545 };
	var maxz = 16;
	var markers = [];
	var is_initialised = false;

	function map_js_loaded() {

		map = new google.maps.Map(document.getElementById('map'),
			{
				zoom: 8,
				minZoom: 3,
				maxZoom: maxz,
				disableDoubleClickZoom: true,
				zoomControl: true,
				mapTypeControl: false,
				scaleControl: false,
				streetViewControl: false,
				rotateControl: false,
				fullscreenControl: false,
				center: start_loc,
			});

		places_service = new google.maps.places.PlacesService(map);

		google.maps.event.addListener(map,
			'click',
			function(event) {
				var loc = event.latLng;
				delete_markers();
				add_location_marker(loc);
				window.external.select_place(loc.lat(), loc.lng(), JSON.stringify(event));

			});

		is_initialised = true;
	}

	function set_location_marker(loc) {
		if (is_initialised) {
			delete_markers();
			add_location_marker(loc);
			map.setCenter(loc);
		} else {
			start_loc = { lat: loc.lat(), lng: loc.lng() };;
		}
	}

	function add_location_marker(location) {
		if (is_initialised) {
			marker = new google.maps.Marker({
				position: location,
				map: map
			});
			markers.push(marker);
		}
	}

    function set_place_marker(place_id) {
		places_service.getDetails({
				placeId: place_id
			},
			function (result, status) {
				if (is_initialised) {
					var loc = result.geometry.location;
					window.external.select_place(loc.lat(), loc.lng(), JSON.stringify(result));
					set_location_marker(loc);
					map.fitBounds(result.geometry.viewport);
				}
			});
	}

	function delete_markers() {
		if (markers) {
			for (i in markers) {
				markers[i].setMap(null);
			}
			markers.length = 0;
		}
	}

	function init_map(key) {
		var js_url = "https://maps.googleapis.com/maps/api/js?key=" + key + "&v=3&callback=map_js_loaded&libraries=places&v=3.47";
        var tag = document.createElement("script");
		tag.setAttribute('src', js_url);
		tag.setAttribute('defer','');
		var first_script_tag = document.getElementsByTagName('script')[0];
		first_script_tag.parentNode.insertBefore(tag, first_script_tag);
	}
</script>

</body>
</html>